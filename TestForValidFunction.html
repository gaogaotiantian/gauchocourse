<html>
<body>

<h1>This is a test.</h1>

<p id = demo>I need to test the course. </p>

<p id = demo1>I need to test the course. </p>

<button type = "button" onclick =change()> Click me!</button>

<script>

var course1 = {
    label : "CMPSC 8 Introduction to Computer Science",
    id : "0",
    sub: "CMPSC",
    number : "8",
    prereq : [{type : "precourse", precourse: {id : "3", concur : "y"}}],
    units : "4",
    gearea :["D", "WOR", "WRT"],
    semester : {"spring":"y", "summer":"y", "fall":"y", "winter":"y"}
    //gearea :["D", "EUR", "WRT"]
}

var course2 = {
	label :"CMPSC 16 Problem Solving with Computers I",
	id : "1",
	sub : "CMPSC",
	number : "16",
	units : "4",
	prereq : [{type: "precourses", precourses : [{id : "3",  concur : "y"}, {id: "4",  concur : "y"}]},
	  		{type: "precourse", precourse : {id :"0", concur :"n"}}],
	gearea :["E", "QUR", "WRT"],
	semester : {"spring":"y", "summer":"y", "fall":"y", "winter":"y"}

}

var course3 = {
	label :"Math 3A, Introduction to Calclus",
	id: "2",
	sub : "MATH",
	number : "3A",
	units : "4",
	prereq : [],
	gearea :["F", "EUR", "WRT"],
	semester : {"spring":"y", "summer":"y", "fall":"y", "winter":"y"}
	

}

var course4 = {
	label :"MATH 34A, CALC FOR SOCIAL SCI",
	id : "3",
	sub : "MATH",
	number : "34A",
	units : "4",
	prereq : [],
	gearea :["G", "EUR", "WRT"],
	semester : {"spring":"y", "summer":"y", "fall":"y", "winter":"y"}
	

}



var inputCourses = [
                    {course : "CMPSC 8 Introduction to Computer Science", semester : "freshman_fall"},
                    {course : "CMPSC 16 Problem Solving with Computers I", semester : "freshman_winter"},
                    {course : "Math 3A, Introduction to Calclus", semester : "freshman_summer"},
                    {course : "MATH 34A, CALC FOR SOCIAL SCI", semester : "freshman_summer"}
] //input courses name with semester that should be provied for the function, this is just a example

var user = {
	major : "Computer Science",
	majorType : "ENGR"
}



var geStatus  = {
	gearea : [{area : "A", taken :0},
	          {area : "B", taken :0},
	          {area : "C", taken :0},
	          {area : "D", taken :0},
	          {area : "E", taken :0},
	          {area : "F", taken :0},
	          {area : "G", taken :0},
	          {area : "H", taken :0}
	],
	otherReq : [ {type : "worldCulturesRequirment", taken : 0},
		         {type : "writing",   taken : 0},
		         {type : "europeanTraditions", taken : 0},
		         {type : "quantitativeRelationships", taken : 0},
		         {type : "ethnicity", taken : 0},
		         {type : "depth", taken :0}
	]
}

var geFullFillment

var courseData  = [course1,course2,course3,course4] //list of all courses as pbject

var addedCourses = [] //list of all inputed courses as a object of course and semester

var schedule = [] //sorted schedule, index represent the semester. ex: schedule[0] is the array of all input courses in freshman summer quarter

var validCourses = [] // list of all valid courses

var invalidData = [] // array of invalidData as object, each object has three variable. 1.name 2.semester 3.message

var check = "" //only for debug purpose

var totalUnit = 0 // totoal units of the current courses add up

var quarterUnit = [] // unit for each quarter, ex: quarterUnit[0] represent the unit of the freshman summer quarter



function ValidateAllInput(input){
    addedCourses = []
    schedule = []
    invalidData = [] 
    validCourses = []
    AddAllCourses(input)
    SortAllCourseBySemester()
    for(var i=0; i<16; i++){
        for(var course of schedule[i]){
            CheckThisCourse(course,i)
        }
    }
    CountUnit()
    console.log("added:", addedCourses)
    console.log("valid:", validCourses)
    console.log("invalid", invalidData)
}

ValidateAllInput(inputCourses)

function IsValid(name){
    if(name == "") return true
    for(course of validCourses){
        if(name == course.label)
            return true
    }
    return false
}

function GetErrorMessage(name){
    if(name == "") return true
    console.log("invalid", invalidData)
    for(er of invalidData){
        if(er.name ==name)
            return er.message
    }
    return ""
}







function SemToNum(semester){
    if(semester == "freshman_summer") return 0;
    if(semester == "freshman_fall") return 1;
    if(semester == "freshman_winter") return 2;
    if(semester == "freshman_spring") return 3;
    if(semester == "sophomore_summer") return 4;
    if(semester == "sophomore_fall") return 5;
    if(semester == "sophomore_winter") return 6;
    if(semester == "sophomore_spring") return 7;
    if(semester == "junior_summer") return 8;
    if(semester == "junior_fall") return 9;
    if(semester == "junior_winter") return 10;
    if(semester == "junior_spring") return 11;
    if(semester == "senior_summer") return 12;
    if(semester == "senior_fall") return 13;
    if(semester == "senior_winter") return 14;
    if(semester == "senior_spring") return 15;
}

function NumToSem(num){
        if(num==0) return "freshman_summer";
        if(num==1) return "freshman_fall";
        if(num==2) return "freshman_winter";
        if(num==3) return "freshman_spring";
        if(num==4) return "sophomore_summer";
        if(num==5) return "sophomore_fall";
        if(num==6) return "sophomore_winter";
        if(num==7) return "sophomore_spring";
        if(num==8) return "junior_summer";
        if(num==9) return "junior_fall";
        if(num==10) return "junior_winter";
        if(num==11) return "junior_spring";
        if(num==12) return "senior_summer";
        if(num==13) return "senior_fall";
        if(num==14) return "senior_winter";
        if(num==15) return "senior_spring";
    }
  
//add all the input courses to the addedCourses
function AddAllCourses(input){
    var existence = false
    var tempname
    for(i=0; i<input.length; i++){
        for(j=0; j<courseData.length; j++){
            var temp = (courseData[j].label);
            if(temp == input[i].course){
                for(z in addedCourses){
                    tempname = (addedCourses[z].course.label)
                    if(tempname == input[i].name){
                        existence = true
                        break
                    }
                }
                if(existence){
                    existence = false
                    break
                }
                addedCourses.push({course : courseData[j], semester : SemToNum(input[i].semester)})
            }
        }
    }

}

//add the courses from addedCourses into schedule in the semester order
function SortAllCourseBySemester(){
    for(i=0; i<16; i++)
        schedule.push([])
    for(i=0; i<addedCourses.length; i++){
        schedule[addedCourses[i].semester].push(addedCourses[i].course)
    }
}

//giving a course name, it will return the course object corresponing to this name
function GetCourseByName(name){
    var tpname
    for(var course of courseData){
        tpname = (course.label)
        if(tpname == name)
            return course
    }
}




//function to check if taking certian course in certain semester is allowed
function CheckThisCourse(course, sem){
    for(var c of validCourses){
        if(c.label == course.label)
            return
    }

    console.log(course)
    var timecheck = true
    var prelength = course.prereq.length
    switch(sem%4){
        case 0 :
            if(course.semester.summer!="y")
                timecheck = false;
            break
        case 1 :
            if(course.semester.fall!="y")
                timecheck = false;
            break
        case 2 :
            if(course.semester.winter!="y")
                timecheck = false;
            break
        case 3 :
            if(course.semester.spring!="y")
                timecheck = false;
            break
    }
    if(!timecheck){
        invalidData.push({name:(course.label), semester : NumToSem(sem), message : "course not offer in this quarter"})
        console.log("prereq" + invalidData)
        return
    }
    
    
    for(n in course.prereq){
        if(course.prereq[n].type == "precourse"){
            var range = sem-1
            var found = false
            if(course.prereq[n].precourse.concur == "y")
                range+=1
            for(s=0; s<=range; s++){
                for(q in schedule[s]){
                    if(course.prereq[n].precourse.id == schedule[s][q].id){
                        var tempcourse = courseData[schedule[s][q].id]
                        CheckThisCourse(tempcourse,s)
                        for(h in validCourses){
                            if(tempcourse.label == validCourses[h].label){
                                found = true
                                break
                            }
                        }
                        if(found) break
                    }
                }
                if(found) break
            }
            if(!found){
                invalidData.push({name:(course.label), semester : NumToSem(sem), message : "course's prerequisites are not fulfilled"})
                console.log("prereq" + invalidData)
                return
            }
        }

        else if(course.prereq[n].type == "precourses"){
            var found = false
            for(var p in course.prereq[n].precourses){
                var range = sem-1
                var id = course.prereq[n].precourses[p].id
                if(course.prereq[n].precourses[p].concur == "y")
                    range+=1
                    for(var s=0; s<=range; s++){
                        for(var q in schedule[s]){
                            if(id == schedule[s][q].id){
                                var tempcourse = courseData[id]
                                CheckThisCourse(tempcourse,s)
                                for(var h of validCourses){
                                    if(h.label == tempcourse.label){
                                        found = true
                                        break
                                    }
                                }
                            }
                            if(found) break
                        }
                    if(found) break
                    }
                                
                if(found) break
            }
            if(!found){
                invalidData.push({name:(course.label), semester : NumToSem(sem), message : "course's prerequisites are not fulfilled"})
                console.log("prereq" + invalidData)
                return
            }
        }
    }
    validCourses.push(course)
}

function CountUnit(){
    var tempunit = 0
    for(qt of schedule){
        for(course of qt){
            tempunit+=Math.round(course.units)
        }
        quarterUnit.push(tempunit)
        totalUnit+=tempunit
        tempunit = 0
    }
}

function UpdateGE(){
	for(area of geStatus.gearea)
		area.taken = 0

	for(req of geStatus.otherReq)
		req.taken = 0

	for(course of validCourses){
		for(ge of course.gearea)
			switch (ge){
				case "A":
					geStatus.gearea[0].taken+=1
					break
				case "B":
					geStatus.gearea[1].taken+=1
					break
				case "C":
					geStatus.gearea[2].taken+=1
					break
				case "D":
					geStatus.gearea[3].taken+=1
					break
				case "E":
					geStatus.gearea[4].taken+=1
					break
				case "F":
					geStatus.gearea[5].taken+=1
					break
				case "G":
					geStatus.gearea[6].taken+=1
					break
				case "h":
					geStatus.gearea[7].taken+=1
					break
				case "WOR":
					geStatus.otherReq[0].taken+=1
					break
				case "WRT":
					geStatus.otherReq[1].taken+=1
					break
				case "EUR":
					geStatus.otherReq[2].taken+=1
					break
				case "QUR":
					geStatus.otherReq[3].taken+=1
					break
				case "ETH":
					geStatus.otherReq[4].taken+=1
					break

			}
	}
	console.log("ge",geStatus)
}



function ValidGE(){
	UpdateGE()
	if(user.majorType=="ENGR"){
		var geFullFillment = [{type : "Area D,E", status : false, 
		                         message : (geStatus.gearea[3].taken+geStatus.gearea[4].taken) +"/2"},
		                  {type : "Area F,G", status : false, 
		                         message : (geStatus.gearea[5].taken+geStatus.gearea[6].taken)+"/2"},
		                  {type : "Area D,E,F,G,H", status : false, 
		                         message : (geStatus.gearea[3].taken+geStatus.gearea[4].taken+geStatus.gearea[5].taken+geStatus.gearea[6].taken+geStatus.gearea[7].taken) +"/6"},
		                  {type : "ETH", status : false, message :(geStatus.otherReq[4].taken)+"/1"},
		                  {type : "WRT", status :false, message : (geStatus.otherReq[1].taken)+"/4"},
		                  {type : "EUR", status : false, message : (geStatus.otherReq[2].taken)+"/1"},
		                  {type : "DEP", status :false, message : (geStatus.otherReq[5].taken)+"/1"}
		]
		if((geStatus.gearea[3].taken+geStatus.gearea[4].taken)>=2)
			geFullFillment[0].status = true
		if((geStatus.gearea[5].taken+geStatus.gearea[6].taken)>=2)
			geFullFillment[1].status = true
		if((geStatus.gearea[3].taken+geStatus.gearea[4].taken+geStatus.gearea[5].taken+geStatus.gearea[6].taken+geStatus.gearea[7].taken)>=6)
			geFullFillment[2].status = true
		if((geStatus.otherReq[4].taken)>=1)
			geFullFillment[3].status = true
		if((geStatus.otherReq[1].taken)>=4)
			geFullFillment[4].status = true
		if((geStatus.otherReq[2].taken)>=1)
			geFullFillment[5].status = true
		if((geStatus.otherReq[5].taken)>=1)
			geFullFillment[6].status = true
		console.log("geFullFillment",geFullFillment)
		return geFullFillment
	}

	else if(user.majorType == "LSBA"){
		var geFullFillment = [{type : "Area C", status :(geStatus.gearea[2].taken>=3), message :geStatus.gearea[2].taken+"/3"},
		                  {type : "Area D", status :(geStatus.gearea[3].taken>=3), message :geStatus.gearea[3].taken+"/3"},
		                  {type : "Area E", status :(geStatus.gearea[4].taken>=3), message :geStatus.gearea[4].taken+"/3"},
		                  {type : "Area F", status :(geStatus.gearea[5].taken>=2), message :geStatus.gearea[5].taken+"/2"},
		                  {type : "Area G", status :(geStatus.gearea[6].taken>=2), message :geStatus.gearea[6].taken+"/2"},
		                  {type : "WOR", status : (geStatus.otherReq[0].taken>=1), message : (geStatus.otherReq[0].taken)+"/1"},
		                  {type : "WRT", status : (geStatus.otherReq[1].taken)>=6, message : (geStatus.otherReq[1].taken)+"/6"},
		                  {type : "EUR", status : (geStatus.otherReq[2].taken>=1), message : (geStatus.otherReq[2].taken)+"/1"},
		                  {type : "QUR", status : (geStatus.otherReq[3].taken>=1), message : (geStatus.otherReq[3].taken)+"/1"},
		                  {type : "ETH", status : (geStatus.otherReq[4].taken>=1), message : (geStatus.otherReq[4].taken)+"/1"}
		]
		return geFullFillment

	}

	else if(user.majorType == "LSBS"){
		var geFullFillment = [{type : "AreaC", status :(geStatus.gearea[2].taken>=3), message :geStatus.gearea[2].taken+"/3"},
		                  {type : "Area D", status :(geStatus.gearea[3].taken>=2), message :geStatus.gearea[3].taken+"/2"},
		                  {type : "Area E", status :(geStatus.gearea[4].taken>=2), message :geStatus.gearea[4].taken+"/2"},
		                  {type : "Area F", status :(geStatus.gearea[5].taken>=1), message :geStatus.gearea[5].taken+"/1"},
		                  {type : "Area G", status :(geStatus.gearea[6].taken>=1), message :geStatus.gearea[6].taken+"/1"},
		                  {type : "WOR", status : (geStatus.otherReq[0].taken>=1), message :(geStatus.otherReq[0].taken)+"/1"},
		                  {type : "WRT", status : (geStatus.otherReq[1].taken)>=6, message :(geStatus.otherReq[1].taken)+"/6"},
		                  {type : "QUR", status : (geStatus.otherReq[3].taken>=1), message :(geStatus.otherReq[3].taken)+"/1"},
		                  {type : "ETH", status : (geStatus.otherReq[4].taken>=1), message :(geStatus.otherReq[4].taken)+"/1"}
		]
		console.log("geFullFillment",geFullFillment)
		return geFullFillment
	}

	else if(user.majorType == "BMFA"){
		var geFullFillment = [{type : "Area C", status :(geStatus.gearea[2].taken>=2), message :geStatus.gearea[2].taken+"/2"},
		                  {type : "Area D", status :(geStatus.gearea[3].taken>=2), message :geStatus.gearea[3].taken+"/2"},
		                  {type : "Area E", status :(geStatus.gearea[4].taken>=2), message :geStatus.gearea[4].taken+"/2"},
		                  {type : "Area G", status :(geStatus.gearea[6].taken>=1), message :geStatus.gearea[6].taken+"/1"},
		                  {type : "WOR", status : (geStatus.otherReq[0].taken>=1), message :(geStatus.otherReq[0].taken)+"/1"},
		                  {type : "WRT", status : (geStatus.otherReq[1].taken)>=6, message :(geStatus.otherReq[1].taken)+"/6"},
		                  {type : "QUR", status : (geStatus.otherReq[3].taken>=1), message :(geStatus.otherReq[3].taken)+"/1"},
		                  {type : "ETH", status : (geStatus.otherReq[4].taken>=1), message :(geStatus.otherReq[4].taken)+"/1"}
		]
		return geFullFillment
	}
	console.log("geFullFillment",geFullFillment)


}


ValidGE()

function change(){
    var x = document.getElementById('demo');
    x.innerHTML = ("haha"+7+"/10")
}


</script>





<body>
<html>



