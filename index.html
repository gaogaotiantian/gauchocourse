<html>
<head>
<link href="Style.css" rel="stylesheet", type="text/css"/>
<script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.11.3.min.js"></script>
<link rel="stylesheet" href="http://code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
<script src="http://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
<script src="gc.js"></script>
<script type="text/javascript">
// Global Variables
var apData = []
var courseData = []
var invalidData = []
var validCourses = []
$(document).ready(function(){
    $.getJSON("example.json", function(data) {
        //courseData = JSON.parse(JSON.stringify(data))
        courseData = data
    })
    .fail(function(d, text, error){alert("error in getJson!" + text + error)})
    $.getJSON("apdata.json", function(data) {
        apData = data
    })
    .fail(function(d, text, error){alert("error in get apdata!" + text + error)})
});
</script>
<script>
$(function() {
$("#error_msg").hide()
$(".inputform").on("mouseenter", ".courseInput", function() {
    if ($(this).attr("valid") == "false") {
        var offset = $(this).offset()
        offset.top = offset.top + $(this).outerHeight()
        $("#error_msg").css("display", "block")
        $("#error_msg").offset(offset)
        $("#error_msg").css("width", $(this).css("width"))
        $("#error_msg").text(GetErrorMessage($(this).val()))
    }
})
.on("mouseleave", ".courseInput", function() {
    $("#error_msg").css("display", "none")
})
.on("blur", ".courseInput", function() {
    if ($(this).val() == "") {
        $(this).attr("valid", "na")
    } else {
        $(this).attr("valid", "true")
    }
    RefreshInputs()
})
.on("focus", ".courseInput", function() {
    $(".courseInput").autocomplete(
        {source: courseData}) 
})
.on("click", ".courseInputRemove", function() {
    $(this).parent().remove()
    RefreshInputs()
})
$(".addInputButton").click(function() {
    var newInput = "<div class='courseInputWrapper'><button class='courseInputRemove'><img src='image/remove.png' class='remove_button'></button><input class='courseInput'></div>"
    $(this).parent().find("form").append(newInput)  
})
function RefreshInputs(){
    var curData = []
    $(".courseInput").each(function(){
        if ($(this).val() != '') {
            var tempdata = {course:$(this).val(), semester:$(this).parent().parent().attr("semester")}
            curData.push(tempdata)
        }
    })
    ValidateAllInput(curData)
    $(".courseInput").each(function() {
        if (IsValid($(this).val())) {
            $(this).attr("valid", "true")
            console.log("true" + $(this).val())
        } else {
            $(this).attr("valid", "false")
            console.log("false" + $(this).val())
        }
    })
}

var apForm,
apForm = $("#ap_form").dialog({
    autoOpen: false,
    height:300,
    width:350,
    modal: true,
    close: function() {
        RefreshInputs()
    }
})
$("#ap_form_button").button().on("click", function(){
    apForm.dialog("open")
})
$("#ap_form").on("click", ".addApSelectButton", function() {
    var newInput = "<div class='apInputWrapper'><button class='apInputRemove'><img src='image/remove.png' class='remove_button'></button>"
    newInput += "<label>Course</label>"
    newInput += "<select class='apCourseSelect' name=''>"
    for (ap of apData) {
        newInput += "<option>"
        newInput += ap.label
        newInput += "</option>"
    }
    newInput += "</select>"
    newInput += "<label>Score</label>"
    newInput += "<select class='apScoreSelect'><option>3</option><option>4</option><option>5</option></select>"
    newInput += "</div>"
    console.log(newInput)
    $(this).parent().find("form").append(newInput) 
})
.on("click", ".apInputRemove", function(){
    $(this).parent().remove()
})
})
</script>
</head>
<body>
<div id="whole_page_wrapper">
    <div id="top_bar">
        <div id="website_logo">
        <p>Gaucho Course</p>
        </div>
        <div id="user_info">
            <label for="sel_major">Major:</label>
            <select name="sel_major">
                <option>CS</option>
                <option>Other</option>
            </select>
            <div id="ap_info">
                <button id="ap_form_button">AP</button>
            </div>
        </div>
    </div>
    <div id="main_content">
        <div id="left_bar">
        <p>Area A 0/1</p> 
        </div>
        <div id="form_area">
            ${form}
        </div>
    <div>
    <div id="footer">
        <p>footer</p>
    </div>
</div>

<p id="error_msg"></p>
<div id="ap_form" title="AP Input">
    <p>put AP here</p>
    <form>
    
    </form>
    <button class="addApSelectButton"><img src="image/add.jpg" class="add_button"></button>
</div>
</body>
</html>
